<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ireneo Demo: TodoMVC with Mutation Sourcing</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const te=(t="ireneo",e="events")=>{let n,r=!1;const s=new Promise((c,o)=>{if(typeof indexedDB>"u"){o(new Error("IndexedDB not available (browser only)"));return}const a=indexedDB.open(t);a.onerror=()=>o(a.error),a.onsuccess=()=>{const l=a.result,f=l.objectStoreNames.contains(e),d=l.version;if(l.close(),f){const u=indexedDB.open(t,d);u.onerror=()=>o(u.error),u.onsuccess=()=>{n=u.result,c()}}else{const u=indexedDB.open(t,d+1);u.onerror=()=>o(u.error),u.onsuccess=()=>{n=u.result,c()},u.onupgradeneeded=y=>{const _=y.target.result;_.objectStoreNames.contains(e)||_.createObjectStore(e,{autoIncrement:!0})}}},a.onupgradeneeded=l=>{const f=l.target.result;f.objectStoreNames.contains(e)||f.createObjectStore(e,{autoIncrement:!0})}}),i=()=>{if(r)throw new Error(`EventLog (${e}) has been closed and cannot be used. This usually happens when switching between memory images.`)};return{append:async c=>(i(),await s,new Promise((o,a)=>{const d=n.transaction([e],"readwrite").objectStore(e).add(c);d.onsuccess=()=>o(),d.onerror=()=>a(d.error)})),getAll:async()=>(i(),await s,new Promise((c,o)=>{const f=n.transaction([e],"readonly").objectStore(e).getAll();f.onsuccess=()=>c(f.result),f.onerror=()=>o(f.error)})),clear:async()=>(i(),await s,new Promise((c,o)=>{const f=n.transaction([e],"readwrite").objectStore(e).clear();f.onsuccess=()=>c(),f.onerror=()=>o(f.error)})),close:async()=>{if(!r){r=!0;try{await s,n&&(n.close(),await new Promise(c=>setTimeout(c,50)))}catch(c){console.warn(`EventLog close(): Database was never initialized (${e})`,c)}}}}};class ne{constructor(){this.delta=new Map,this.DELETED=Symbol("deleted")}getDeletedSymbol(){return this.DELETED}isDirty(){return this.delta.size>0}size(){return this.delta.size}has(e){return this.delta.has(e)}get(e){return this.delta.get(e)}set(e,n){this.delta.set(e,n)}delete(e){this.delta.set(e,this.DELETED)}isDeleted(e){return this.delta.get(e)===this.DELETED}clear(){this.delta.clear()}entries(){return Array.from(this.delta.entries()).sort((e,n)=>{const r=e[0].split(".").length,s=n[0].split(".").length;return r-s})}createCheckpoint(){return new Map(this.delta)}restoreCheckpoint(e){this.delta.clear();for(const[n,r]of e)this.delta.set(n,r)}}function re(t){return t!==null&&typeof t=="object"}function I(t,e,n=new WeakMap){if(!re(t))return t;if(n.has(t))return n.get(t);const r=e.has(t)?e.get(t):t;if(r!==t&&n.has(r)){const o=n.get(r);return n.set(t,o),o}if(r instanceof Map){const o=new Map;n.set(t,o),r!==t&&n.set(r,o);let a=!1;for(const[f,d]of r.entries()){const u=I(f,e,n),y=I(d,e,n);o.set(u,y),(u!==f||y!==d)&&(a=!0)}const l=a?o:r;return n.set(t,l),r!==t&&n.set(r,l),l}if(r instanceof Set){const o=new Set;n.set(t,o),r!==t&&n.set(r,o);let a=!1;for(const f of r.values()){const d=I(f,e,n);o.add(d),d!==f&&(a=!0)}const l=a?o:r;return n.set(t,l),r!==t&&n.set(r,l),l}if(Array.isArray(r)){const o=[];n.set(t,o),r!==t&&n.set(r,o);let a=!1;for(const f of r){const d=I(f,e,n);o.push(d),d!==f&&(a=!0)}const l=a?o:r;return n.set(t,l),r!==t&&n.set(r,l),l}const s={};n.set(t,s),r!==t&&n.set(r,s);let i=!1;for(const[o,a]of Object.entries(r)){const l=I(a,e,n);s[o]=l,l!==a&&(i=!0)}const c=i?s:r;return n.set(t,c),r!==t&&n.set(r,c),c}function Y(t){return t!==null&&typeof t=="object"}function L(t,e,n,r,s){if(r.has(t))return r.get(t);const i=e.getDeletedSymbol(),c=new Proxy(t,{get(o,a){if(typeof a=="symbol")return o[a];const l=[...n,String(a)],f=l.join(".");if(e.has(f)){const u=e.get(f);return u===i?void 0:Y(u)?s.has(u)?u:L(u,e,l,r,s):u}const d=o[a];if(typeof d=="function"&&Array.isArray(o)){const u=String(a);return["push","pop","shift","unshift","splice","sort","reverse"].includes(u)?function(...S){const E=n.join(".");let A;e.has(E)?A=e.get(E):(A=[...o],e.set(E,A));let x=S;return(u==="push"||u==="unshift"||u==="splice")&&(x=S.map((P,H)=>{if(!Y(P))return P;if(r.has(P))return r.get(P);if(s.has(P))return P;let M;if(u==="push")M=[...n,String(A.length+H)];else if(u==="unshift")M=[...n,String(H)];else{const ee=S[0];if(H<2)return P;M=[...n,String(ee+H-2)]}return L(P,e,M,r,s)})),d.apply(A,x)}:["find","findLast","filter","map","flatMap"].includes(u)?function(...S){const E=d.apply(o,S);if(E==null)return E;if(u==="find"||u==="findLast"){if(Y(E)){const A=o.indexOf(E);if(A!==-1){const x=[...n,String(A)];return L(E,e,x,r,s)}}return E}else return Array.isArray(E)?E.map((A,x)=>{if(Y(A)){const N=o.indexOf(A);if(N!==-1){const P=[...n,String(N)];return L(A,e,P,r,s)}}return A}):E}:d.bind(o)}return Y(d)?s.has(d)?d:L(d,e,l,r,s):d},set(o,a,l){const d=[...n,String(a)].join(".");return e.set(d,l),!0},has(o,a){const f=[...n,String(a)].join(".");return e.has(f)?e.get(f)!==i:a in o},deleteProperty(o,a){const f=[...n,String(a)].join(".");return e.delete(f),!0},ownKeys(o){const a=Reflect.ownKeys(o),l=n.length>0?n.join(".")+".":"",f=new Set;for(const[u,y]of e.entries())if(u.startsWith(l)){const _=u.slice(l.length),S=_.indexOf("."),E=S===-1?_:_.slice(0,S);y!==i&&f.add(E)}const d=new Set(a);for(const[u,y]of e.entries())if(u.startsWith(l)){const _=u.slice(l.length);if(_.indexOf(".")===-1){const E=_;y===i?d.delete(E):d.add(E)}}return Array.from(d)},getOwnPropertyDescriptor(o,a){const f=[...n,String(a)].join(".");if(e.has(f)){const d=e.get(f);return d===i?void 0:{value:d,writable:!0,enumerable:!0,configurable:!0}}return Reflect.getOwnPropertyDescriptor(o,a)}});return r.set(t,c),s.set(c,t),c}const p={SET:"SET",DELETE:"DELETE",ARRAY_PUSH:"ARRAY_PUSH",ARRAY_POP:"ARRAY_POP",ARRAY_SHIFT:"ARRAY_SHIFT",ARRAY_UNSHIFT:"ARRAY_UNSHIFT",ARRAY_SPLICE:"ARRAY_SPLICE",ARRAY_SORT:"ARRAY_SORT",ARRAY_REVERSE:"ARRAY_REVERSE",ARRAY_FILL:"ARRAY_FILL",ARRAY_COPYWITHIN:"ARRAY_COPYWITHIN",MAP_SET:"MAP_SET",MAP_DELETE:"MAP_DELETE",MAP_CLEAR:"MAP_CLEAR",SET_ADD:"SET_ADD",SET_DELETE:"SET_DELETE",SET_CLEAR:"SET_CLEAR",SCRIPT:"SCRIPT"},v={TYPE:"__type__",CLASS:"__class__",DATE_VALUE:"__dateValue__"};var g=(t=>(t[t.NULL=0]="NULL",t[t.UNDEFINED=1]="UNDEFINED",t[t.PRIMITIVE=2]="PRIMITIVE",t[t.BIGINT=3]="BIGINT",t[t.SYMBOL=4]="SYMBOL",t[t.DATE=5]="DATE",t[t.REGEXP=6]="REGEXP",t[t.FUNCTION=7]="FUNCTION",t[t.ARRAY=8]="ARRAY",t[t.MAP=9]="MAP",t[t.SET=10]="SET",t[t.OBJECT=11]="OBJECT",t))(g||{});function se(t){if(t===null)return{category:0,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};if(t===void 0)return{category:1,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};const e=typeof t;return e==="string"||e==="number"||e==="boolean"?{category:2,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1}:e==="bigint"?{category:3,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:e==="symbol"?{category:4,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:t instanceof Date?{category:5,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:t instanceof RegExp?{category:6,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:e==="function"?{category:7,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:Array.isArray(t)?{category:8,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!1}:t instanceof Map?{category:9,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:t instanceof Set?{category:10,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:{category:11,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!1}}function oe(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return!(e===null||e===Object.prototype||t instanceof Date||t instanceof RegExp||t instanceof Map||t instanceof Set||t instanceof Array||t instanceof Error||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)}function ie(t){const e=Object.getPrototypeOf(t);if(!e||e===Object.prototype)return null;const n=e.constructor;return!n||!n.name?null:n.name}class ce{constructor(e,n){this.targetToPath=e,this.currentPath=n,this.seen=new Map}hasSeen(e){return this.seen.has(e)}markSeen(e,n){this.seen.set(e,n)}getReference(e){const n=this.targetToPath.get(e);return n&&n.length>0&&!(n.length>=this.currentPath.length&&this.currentPath.every((s,i)=>s===n[i]))?{__type__:"ref",path:n}:this.hasSeen(e)?{__type__:"ref",path:this.seen.get(e).slice(this.currentPath.length)}:null}}function D(t,e,n,r){const s=typeof t=="object"&&t!==null&&r.get(t)||t,i=se(s);switch(i.category){case g.NULL:case g.UNDEFINED:return t;case g.PRIMITIVE:return t;case g.BIGINT:return{[v.TYPE]:"bigint",value:t.toString()};case g.SYMBOL:return{[v.TYPE]:"symbol",description:t.description};case g.DATE:{const c=r.get(t)||t,o=n.getReference(c);if(o)return o;n.markSeen(c,e);const a=c,l=a.getTime(),f=isNaN(l)?null:a.toISOString(),d={[v.TYPE]:"date",[v.DATE_VALUE]:f},u=Object.entries(a);for(const[y,_]of u)d[y]=D(_,[...e,y],n,r);return d}case g.REGEXP:{const c=r.get(t)||t,o=n.getReference(c);if(o)return o;n.markSeen(c,e);const a=c;return{[v.TYPE]:"regexp",source:a.source,flags:a.flags,lastIndex:a.lastIndex}}case g.FUNCTION:{const c=t;return c.__type__==="function"?{[v.TYPE]:"function",sourceCode:c.sourceCode||t.toString()}:void 0}case g.MAP:case g.SET:case g.ARRAY:case g.OBJECT:{const c=r.get(t)||t,o=n.getReference(c);if(o)return o;if(n.markSeen(c,e),i.category===g.MAP)return{[v.TYPE]:"map",entries:Array.from(c.entries()).map(([f,d],u)=>[D(f,[...e,"key",String(u)],n,r),D(d,[...e,"value",String(u)],n,r)])};if(i.category===g.SET)return{[v.TYPE]:"set",values:Array.from(c.values()).map((f,d)=>D(f,[...e,String(d)],n,r))};if(i.category===g.ARRAY)return t.map((f,d)=>D(f,[...e,String(d)],n,r));const a={},l=t;if(oe(c)){const f=ie(c);f&&(a[v.CLASS]=f)}for(const f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=D(l[f],[...e,f],n,r));return a}default:return}}const R=(t,e,n,r)=>{const s=new ce(n,r);return D(t,r,s,e)},ae=t=>typeof t=="object"&&t!==null&&"__type__"in t&&typeof t.__type__=="string",W=t=>{const n=new Function(`return (${t.sourceCode})`)();return n.__type__="function",n.sourceCode=t.sourceCode,n},q=(t,e,n)=>{if(!("__dateValue__"in t))throw new Error("Invalid Date serialization format: missing __dateValue__ field");const r=t.__dateValue__,s=r===null?new Date("invalid"):new Date(r);for(const[i,c]of Object.entries(t))i==="__type__"||i==="__dateValue__"||(s[i]=e(c,n));return s},G=t=>{const e=new RegExp(t.source,t.flags);return t.lastIndex!==void 0&&(e.lastIndex=t.lastIndex),e},J=t=>BigInt(t.value),X=t=>Symbol(t.description),k=t=>typeof t=="object"&&t!==null&&"__unresolved_ref__"in t,le=(t,e)=>{const n=new Map;for(const[r,s]of t.entries){const i=typeof r=="object"&&r!==null&&r.__type__&&T[r.__type__]?.(r,e)||r,c=typeof s=="object"&&s!==null&&s.__type__&&T[s.__type__]?.(s,e)||s;n.set(i,c)}return n},fe=(t,e)=>{const n=new Set;for(const r of t.values){const s=typeof r=="object"&&r!==null&&r.__type__&&T[r.__type__]?.(r,e)||r;n.add(s)}return n},T={function:t=>W(t),date:(t,e)=>q(t,(r,s)=>{if(r&&typeof r=="object"&&"__type__"in r){const i=T[r.__type__];return i?i(r,e):r}return r},e),regexp:t=>G(t),bigint:t=>J(t),symbol:t=>X(t),ref:t=>({__unresolved_ref__:t.path}),map:(t,e)=>le(t,e),set:(t,e)=>fe(t,e)};function de(t,e,n){const r=[];function s(c,o=[]){if(c===null||typeof c!="object")return c;if(c.__type__&&T[c.__type__]){const a=T[c.__type__];if(!a)return c;const l=a(c,t);if(l&&k(l))return r.push({parent:null,key:null,path:l.__unresolved_ref__}),l;if(l instanceof Date){for(const f in l)if(Object.prototype.hasOwnProperty.call(l,f)){const d=l[f];d&&k(d)&&r.push({parent:l,key:f,path:d.__unresolved_ref__})}}return l}for(const a in c)if(Object.prototype.hasOwnProperty.call(c,a)){const l=c[a];if(l&&typeof l=="object")if(l.__type__&&T[l.__type__]){const f=T[l.__type__];if(!f)continue;const d=f(l,t);if(d&&k(d))r.push({parent:c,key:a,path:d.__unresolved_ref__});else if(c[a]=d,d instanceof Date){for(const u in d)if(Object.prototype.hasOwnProperty.call(d,u)){const y=d[u];y&&k(y)&&r.push({parent:d,key:u,path:y.__unresolved_ref__})}}}else{const f=s(l,[...o,a]);f!==l&&(c[a]=f)}}return c}let i=s(t);for(const c of r){const{parent:o,key:a,path:l}=c,f=e(l,i);o&&a!==null?o[a]=f:o===null&&a===null&&(i=f)}return i}function ue(t,e,n){return de(t,(i,c)=>{let o=c,a=!0;for(const l of i){const f=o?.[l];if(f===void 0){a=!1;break}o=f}if(a)return o;o=e;for(const l of i){const f=o?.[l];if(f===void 0)throw new Error(`Cannot resolve event value ref path: ${i.join(".")} (not found in value scope or memory scope)`);o=f}return o})}const w=(t,e,n=new WeakMap,r)=>{if(t==null||typeof t!="object")return t;if(n.has(t))return n.get(t);if(ae(t)){const i=t;switch(i.__type__){case"function":return W(i);case"date":return q(i,(a,l)=>w(a,e,n),e);case"regexp":return G(i);case"bigint":return J(i);case"symbol":return X(i);case"ref":{const c=i;let o=e;for(const a of c.path)if(o=o[a],o===void 0)throw new Error(`Cannot resolve ref path: ${c.path.join(".")}`);return o}case"map":{const c=i,o=new Map;n.set(t,o);for(const[a,l]of c.entries){const f=w(a,e,n),d=w(l,e,n);o.set(f,d)}return o}case"set":{const c=i,o=new Set;n.set(t,o);for(const a of c.values)o.add(w(a,e,n));return o}case"circular":throw new Error("Encountered explicit circular marker - this indicates a serialization issue")}}if(Array.isArray(t)){const i=[];n.set(t,i);for(const c of t)i.push(w(c,e,n));return i}const s={};n.set(t,s);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=w(t[i],e,n));return s};class pe{createEvent(e,n,r){const[s]=n;return{type:p.SET,path:e,value:R(s,r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e;n[r]=ue(i.value,s)}}class ye{createEvent(e){return{type:p.DELETE,path:e,timestamp:Date.now()}}applyEvent(e,n,r){delete n[r]}}class Ee{createEvent(e,n,r){return{type:p.ARRAY_PUSH,path:e,items:n.map(s=>R(s,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r];for(const o of i.items)c.push(w(o,s))}}class _e{createEvent(e){return{type:p.ARRAY_POP,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].pop()}}class me{createEvent(e){return{type:p.ARRAY_SHIFT,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].shift()}}class he{createEvent(e,n,r){return{type:p.ARRAY_UNSHIFT,path:e,items:n.map(s=>R(s,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=i.items.map(a=>w(a,s));c.unshift(...o)}}class ge{createEvent(e,n,r){return{type:p.ARRAY_SPLICE,path:e,start:n[0],deleteCount:n[1]||0,items:n.slice(2).map(s=>R(s,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=i.items.map(a=>w(a,s));c.splice(i.start,i.deleteCount,...o)}}class Ae{createEvent(e){return{type:p.ARRAY_SORT,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].sort()}}class we{createEvent(e){return{type:p.ARRAY_REVERSE,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].reverse()}}class Se{createEvent(e,n,r){return{type:p.ARRAY_FILL,path:e,value:R(n[0],r.proxyToTarget,r.targetToPath,e),start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=w(i.value,s);c.fill(o,i.start,i.end)}}class Re{createEvent(e,n){return{type:p.ARRAY_COPYWITHIN,path:e,target:n[0],start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,r){const s=e;n[r].copyWithin(s.target,s.start,s.end)}}class Pe{createEvent(e,n,r){return{type:p.MAP_SET,path:e,key:R(n[0],r.proxyToTarget,r.targetToPath,e),value:R(n[1],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=w(i.key,s),a=w(i.value,s);c.set(o,a)}}class ve{createEvent(e,n,r){return{type:p.MAP_DELETE,path:e,key:R(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=w(i.key,s);c.delete(o)}}class Te{createEvent(e){return{type:p.MAP_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].clear()}}class De{createEvent(e,n,r){return{type:p.SET_ADD,path:e,value:R(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=w(i.value,s);c.add(o)}}class Ie{createEvent(e,n,r){return{type:p.SET_DELETE,path:e,value:R(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,s){const i=e,c=n[r],o=w(i.value,s);c.delete(o)}}class Le{createEvent(e){return{type:p.SET_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].clear()}}class Oe{createEvent(e,n){return{type:p.SCRIPT,path:e,source:n[0],timestamp:Date.now()}}applyEvent(){}}class be{constructor(){this.handlers=new Map}register(e,n){this.handlers.set(e,n)}createEvent(e,n,r,s){const i=this.handlers.get(e);if(!i)throw new Error(`No handler registered for event type: ${e}`);return i.createEvent(n,r,s)}applyEvent(e,n,r,s){const i=this.handlers.get(e.type);if(!i)throw new Error(`No handler registered for event type: ${e.type}`);i.applyEvent(e,n,r,s)}hasHandler(e){return this.handlers.has(e)}}const m=new be;m.register(p.SET,new pe);m.register(p.DELETE,new ye);m.register(p.ARRAY_PUSH,new Ee);m.register(p.ARRAY_POP,new _e);m.register(p.ARRAY_SHIFT,new me);m.register(p.ARRAY_UNSHIFT,new he);m.register(p.ARRAY_SPLICE,new ge);m.register(p.ARRAY_SORT,new Ae);m.register(p.ARRAY_REVERSE,new we);m.register(p.ARRAY_FILL,new Se);m.register(p.ARRAY_COPYWITHIN,new Re);m.register(p.MAP_SET,new Pe);m.register(p.MAP_DELETE,new ve);m.register(p.MAP_CLEAR,new Te);m.register(p.SET_ADD,new De);m.register(p.SET_DELETE,new Ie);m.register(p.SET_CLEAR,new Le);m.register(p.SCRIPT,new Oe);const F=(t,e)=>{let n=t;for(let s=0;s<e.path.length-1;s++){const i=e.path[s];if(i){if(!(i in n)){const c=e.path[s+1];n[i]=c&&/^\d+$/.test(c)?[]:{}}n=n[i]}}const r=e.path[e.path.length-1];r&&m.applyEvent(e,n,r,t)},U=async(t,e,n)=>{if(n.isReplaying=!0,Array.isArray(e))for(const r of e)F(t,r);else for await(const r of e)F(t,r);n.isReplaying=!1},xe=async(t,e,n)=>{if(e.stream)await U(t,e.stream(),n);else{const r=await e.getAll();await U(t,r,n)}};async function Q(t){const e=new ne,n=e.getDeletedSymbol(),r=new WeakMap,s=new WeakMap,i={};return await xe(i,t,{isReplaying:!0}),{root:L(i,e,[],r,s),isDirty(){return e.isDirty()},getUncommittedCount(){return e.size()},async save(){const o=e.entries(),a=new WeakMap,l=(f,d,u=[])=>{if(!(d===null||typeof d!="object")&&!f.has(d))if(f.set(d,u),Array.isArray(d))d.forEach((y,_)=>l(f,y,[...u,String(_)]));else if(d instanceof Map){let y=0;d.forEach(_=>l(f,_,[...u,`map:${y++}`]))}else if(d instanceof Set){let y=0;d.forEach(_=>l(f,_,[...u,`set:${y++}`]))}else d instanceof Date||Object.entries(d).forEach(([y,_])=>l(f,_,[...u,y]))};for(const[f,d]of o){const u=new WeakMap;l(u,i);const y=f.split(".");let _=i;for(let E=0;E<y.length-1;E++)_=_[y[E]];const S=y[y.length-1];if(d===n)delete _[S],await t.append({type:"DELETE",path:y,timestamp:Date.now()});else{const E=I(d,s,a),A=R(E,new WeakMap,u,y);_[S]=E,await t.append({type:"SET",path:y,value:A,timestamp:Date.now()})}}e.clear()},discard(){e.clear()},createCheckpoint(){return e.createCheckpoint()},restoreCheckpoint(o){e.restoreCheckpoint(o)},unwrap(o){return I(o,s)}}}let O,b,h;async function j(){try{O=te("ireneo-demo","todos"),b=await Q(O),h=b.root,h.todos||(h.todos=[],h.nextId=1);const t=localStorage.getItem("ireneo-demo-theme")||"light";document.documentElement.setAttribute("data-theme",t),Z(t),Be(),await z(),console.log("Ireneo demo initialized"),console.log(`Loaded ${h.todos.length} todos from IndexedDB`)}catch(t){console.error("Initialization error:",t),alert("Failed to initialize app. Check console for details.")}}async function K(t){if(!t.trim())return;h.todos.push({id:h.nextId++,text:t.trim(),done:!1,createdAt:new Date}),await $();const e=document.getElementById("new-todo");e&&(e.value=""),await z()}async function Ye(t){const e=h.todos.find(n=>n.id===t);e&&(e.done=!e.done,await $(),await z())}async function ze(t){const e=h.todos.findIndex(n=>n.id===t);e>=0&&(h.todos.splice(e,1),await $(),await z())}async function $(){try{await b.save(),C("Saved to IndexedDB","success")}catch(t){console.error("Save error:",t),C("Save failed","error")}}async function He(){if(confirm("Clear all todos and events? This cannot be undone."))try{h.todos.length=0,h.nextId=1,await b.save(),O.clear&&await O.clear(),b=await Q(O),h=b.root,h.todos=[],h.nextId=1,await z(),C("All data cleared","success")}catch(t){console.error("Clear error:",t),C("Clear failed","error")}}async function z(){Me(),await ke()}function Me(){const t=document.getElementById("todo-list");if(t){if(h.todos.length===0){t.innerHTML='<li class="empty-state" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">No todos yet. Add one above!</li>';return}t.innerHTML=h.todos.map(e=>`
    <li class="todo-item ${e.done?"done":""}">
      <input
        type="checkbox"
        ${e.done?"checked":""}
        onchange="window.toggleTodoAsync(${e.id})"
      />
      <span class="todo-text">${B(e.text)}</span>
      <button class="todo-delete" onclick="window.deleteTodoAsync(${e.id})" title="Delete">×</button>
    </li>
  `).join("")}}async function ke(){const t=document.getElementById("event-list"),e=document.getElementById("event-count"),n=document.getElementById("storage-size");if(!(!t||!e||!n))try{const r=await O.getAll();if(r.length===0){t.innerHTML='<div class="empty-state" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">No events yet. Interact with todos to see mutations!</div>',e.textContent="0 events",n.textContent="0 KB";return}const s=r.slice(-50).reverse();t.innerHTML=s.map(o=>{const a=JSON.stringify(o.path);let l="";return o.type==="SET"&&"value"in o?l=`<div class="event-value">value: ${V(o.value)}</div>`:o.type==="ARRAY_PUSH"&&"items"in o?l=`<div class="event-value">pushed: ${V(o.items[0])}</div>`:o.type==="ARRAY_SPLICE"&&"start"in o&&(l=`<div class="event-value">index: ${o.start}, deleted: ${o.deleteCount}</div>`),`
        <div class="event event-${o.type}">
          <span class="event-type">${o.type}</span>
          <div class="event-path">${B(a)}</div>
          ${l}
        </div>
      `}).join(""),e.textContent=`${r.length} event${r.length!==1?"s":""}`;const c=(JSON.stringify(r).length/1024).toFixed(1);n.textContent=`${c} KB`}catch(r){console.error("Error rendering events:",r),t.innerHTML='<div style="color: var(--danger); padding: 1rem;">Error loading events</div>'}}function Be(){const t=document.getElementById("add-btn"),e=document.getElementById("new-todo");t&&e&&(t.addEventListener("click",()=>{K(e.value).catch(console.error)}),e.addEventListener("keypress",s=>{s.key==="Enter"&&K(e.value).catch(console.error)}));const n=document.getElementById("clear-all-btn");n&&n.addEventListener("click",He);const r=document.getElementById("theme-toggle");r&&r.addEventListener("click",Ce),window.toggleTodoAsync=s=>Ye(s).catch(console.error),window.deleteTodoAsync=s=>ze(s).catch(console.error)}function Ce(){const e=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("ireneo-demo-theme",e),Z(e)}function Z(t){const e=document.getElementById("theme-toggle");e&&(e.textContent=t==="light"?"🌙":"☀️")}function B(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function V(t){return typeof t=="string"?`"${B(t)}"`:B(JSON.stringify(t,null,2))}function C(t,e){console.log(`[${e.toUpperCase()}] ${t}`)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();</script>
  <style rel="stylesheet" crossorigin>:root{--primary: #4F46E5;--primary-hover: #4338CA;--success: #10B981;--warning: #F59E0B;--danger: #EF4444;--bg-primary: #FFFFFF;--bg-secondary: #F9FAFB;--bg-tertiary: #F3F4F6;--text-primary: #111827;--text-secondary: #6B7280;--text-tertiary: #9CA3AF;--border: #E5E7EB;--border-focus: #4F46E5;--event-push-bg: #D1FAE5;--event-push-border: #10B981;--event-set-bg: #FED7AA;--event-set-border: #F59E0B;--event-delete-bg: #FECACA;--event-delete-border: #EF4444;--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .05);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .1)}[data-theme=dark]{--bg-primary: #1F2937;--bg-secondary: #111827;--bg-tertiary: #374151;--text-primary: #F9FAFB;--text-secondary: #D1D5DB;--text-tertiary: #9CA3AF;--border: #374151;--border-focus: #6366F1;--event-push-bg: #065F46;--event-push-border: #10B981;--event-set-bg: #78350F;--event-set-border: #F59E0B;--event-delete-bg: #7F1D1D;--event-delete-border: #EF4444;--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .4);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .5)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;color:var(--text-primary);background:var(--bg-secondary);transition:background-color .2s ease,color .2s ease}.container{max-width:1400px;margin:0 auto;padding:2rem 1.5rem}.header{text-align:center;margin-bottom:2rem}.header h1{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem}.header .subtitle{font-size:1rem;color:var(--text-secondary)}.app{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-bottom:2rem}.panel{background:var(--bg-primary);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow-md);overflow:hidden;display:flex;flex-direction:column;min-height:600px}.panel-header{padding:1.5rem;border-bottom:1px solid var(--border);background:var(--bg-secondary)}.panel-header h2{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.panel-header .subtitle{font-size:.875rem;color:var(--text-secondary);margin-top:.25rem}.panel-content{padding:1.5rem;flex:1;display:flex;flex-direction:column;overflow:hidden}.input-group{display:flex;gap:.5rem;margin-bottom:1.5rem}#new-todo{flex:1;padding:.75rem 1rem;font-size:1rem;border:1px solid var(--border);border-radius:8px;background:var(--bg-primary);color:var(--text-primary);transition:border-color .15s ease,box-shadow .15s ease}#new-todo:focus{outline:none;border-color:var(--border-focus);box-shadow:0 0 0 3px #4f46e51a}#new-todo::placeholder{color:var(--text-tertiary)}.btn{padding:.75rem 1.25rem;font-size:.875rem;font-weight:500;border:none;border-radius:8px;cursor:pointer;transition:all .15s ease;white-space:nowrap}.btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:var(--primary-hover);transform:translateY(-1px);box-shadow:var(--shadow-md)}.btn-secondary{background:var(--bg-tertiary);color:var(--text-primary);border:1px solid var(--border)}.btn-secondary:hover{background:var(--bg-secondary);transform:translateY(-1px)}.btn-success{background:var(--success);color:#fff}.btn-success:hover{background:#059669;transform:translateY(-1px)}.btn-danger{background:var(--danger);color:#fff}.btn-danger:hover{background:#dc2626;transform:translateY(-1px)}.btn:disabled{opacity:.5;cursor:not-allowed;transform:none!important}.icon-btn{background:none;border:none;font-size:1.25rem;cursor:pointer;padding:.25rem .5rem;transition:transform .15s ease}.icon-btn:hover{transform:scale(1.1)}.todo-list{list-style:none;flex:1;overflow-y:auto;margin-bottom:1.5rem}.todo-item{display:flex;align-items:center;gap:.75rem;padding:.875rem;border-radius:8px;background:var(--bg-secondary);border:1px solid var(--border);margin-bottom:.5rem;transition:all .15s ease}.todo-item:hover{border-color:var(--primary);box-shadow:var(--shadow-sm)}.todo-item.done .todo-text{text-decoration:line-through;color:var(--text-tertiary)}.todo-item input[type=checkbox]{width:1.25rem;height:1.25rem;cursor:pointer;accent-color:var(--primary)}.todo-text{flex:1;color:var(--text-primary);font-size:.9375rem}.todo-delete{background:var(--danger);color:#fff;border:none;border-radius:4px;width:1.75rem;height:1.75rem;font-size:1.125rem;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease}.todo-delete:hover{background:#dc2626;transform:scale(1.1)}.actions{display:flex;gap:.5rem;flex-wrap:wrap}.auto-save-notice{margin-top:.75rem;text-align:center}.event-list{flex:1;overflow-y:auto;margin-bottom:1rem;display:flex;flex-direction:column;gap:.5rem}.event{padding:.75rem 1rem;border-radius:6px;border-left:3px solid;font-size:.875rem;animation:slideIn .3s ease}@keyframes slideIn{0%{opacity:0;transform:translate(-10px)}to{opacity:1;transform:translate(0)}}.event-ARRAY_PUSH{background:var(--event-push-bg);border-color:var(--event-push-border)}.event-SET{background:var(--event-set-bg);border-color:var(--event-set-border)}.event-ARRAY_SPLICE,.event-DELETE{background:var(--event-delete-bg);border-color:var(--event-delete-border)}.event-type{font-weight:600;font-family:Monaco,Courier New,monospace;font-size:.8125rem;display:inline-block;margin-right:.5rem}.event-path{font-family:Monaco,Courier New,monospace;font-size:.75rem;color:var(--text-secondary);display:block;margin-top:.25rem;word-break:break-all}.event-value{font-family:Monaco,Courier New,monospace;font-size:.75rem;color:var(--text-primary);display:block;margin-top:.25rem;word-break:break-all}.stats{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--bg-secondary);border-radius:8px;font-size:.875rem;color:var(--text-secondary);border:1px solid var(--border)}.stat{font-weight:500}.separator{color:var(--text-tertiary)}.footer{text-align:center;padding:2rem 0;font-size:.875rem;color:var(--text-secondary)}.footer a{color:var(--primary);text-decoration:none;transition:color .15s ease}.footer a:hover{color:var(--primary-hover);text-decoration:underline}@media(max-width:768px){.app{grid-template-columns:1fr}.header h1{font-size:2rem}.container{padding:1rem}}.todo-list::-webkit-scrollbar,.event-list::-webkit-scrollbar{width:8px}.todo-list::-webkit-scrollbar-track,.event-list::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:4px}.todo-list::-webkit-scrollbar-thumb,.event-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.todo-list::-webkit-scrollbar-thumb:hover,.event-list::-webkit-scrollbar-thumb:hover{background:var(--text-tertiary)}</style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Ireneo Demo</h1>
            <p class="subtitle">TodoMVC with Mutation Sourcing</p>
        </header>

        <div class="app">
            <!-- Left Panel: Todo List -->
            <div class="panel todos-panel">
                <div class="panel-header">
                    <h2>📝 Todos</h2>
                </div>
                <div class="panel-content">
                    <div class="input-group">
                        <input
                            id="new-todo"
                            type="text"
                            placeholder="What needs to be done?"
                            autocomplete="off"
                        />
                        <button id="add-btn" class="btn btn-primary">Add</button>
                    </div>
                    <ul id="todo-list" class="todo-list"></ul>
                    <div class="actions">
                        <button id="clear-all-btn" class="btn btn-danger">Clear All</button>
                    </div>
                    <div class="auto-save-notice">
                        <small style="color: var(--text-tertiary);">✨ Auto-saves on every change</small>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Event Log -->
            <div class="panel events-panel">
                <div class="panel-header">
                    <h2>📊 Event Log</h2>
                    <span class="subtitle">Live Mutation Tracking</span>
                </div>
                <div class="panel-content">
                    <div id="event-list" class="event-list"></div>
                    <div class="stats">
                        <span id="event-count" class="stat">0 events</span>
                        <span class="separator">•</span>
                        <span id="storage-size" class="stat">0 KB</span>
                        <button id="theme-toggle" class="icon-btn" title="Toggle theme">🌙</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>
                Powered by <a href="https://github.com/xrrocha/ireneo" target="_blank">Ireneo</a>
                • No server, no database, just JavaScript
                • <a href="https://github.com/xrrocha/ireneo/blob/main/docs/primer.md" target="_blank">Read the Primer</a>
            </p>
        </footer>
    </div>

    <!-- Load main module -->
</body>
</html>
