<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ireneo Demo: TodoMVC with Mutation Sourcing</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const se=(t="ireneo",e="events")=>{let n,s=!1;const r=new Promise((c,i)=>{if(typeof indexedDB>"u"){i(new Error("IndexedDB not available (browser only)"));return}const a=indexedDB.open(t);a.onerror=()=>i(a.error),a.onsuccess=()=>{const l=a.result,f=l.objectStoreNames.contains(e),u=l.version;if(l.close(),f){const d=indexedDB.open(t,u);d.onerror=()=>i(d.error),d.onsuccess=()=>{n=d.result,c()}}else{const d=indexedDB.open(t,u+1);d.onerror=()=>i(d.error),d.onsuccess=()=>{n=d.result,c()},d.onupgradeneeded=h=>{const A=h.target.result;A.objectStoreNames.contains(e)||A.createObjectStore(e,{autoIncrement:!0})}}},a.onupgradeneeded=l=>{const f=l.target.result;f.objectStoreNames.contains(e)||f.createObjectStore(e,{autoIncrement:!0})}}),o=()=>{if(s)throw new Error(`EventLog (${e}) has been closed and cannot be used. This usually happens when switching between memory images.`)};return{append:async c=>(o(),await r,new Promise((i,a)=>{const u=n.transaction([e],"readwrite").objectStore(e).add(c);u.onsuccess=()=>i(),u.onerror=()=>a(u.error)})),getAll:async()=>(o(),await r,new Promise((c,i)=>{const f=n.transaction([e],"readonly").objectStore(e).getAll();f.onsuccess=()=>c(f.result),f.onerror=()=>i(f.error)})),clear:async()=>(o(),await r,new Promise((c,i)=>{const f=n.transaction([e],"readwrite").objectStore(e).clear();f.onsuccess=()=>c(),f.onerror=()=>i(f.error)})),close:async()=>{if(!s){s=!0;try{await r,n&&(n.close(),await new Promise(c=>setTimeout(c,50)))}catch(c){console.warn(`EventLog close(): Database was never initialized (${e})`,c)}}}}};class re{constructor(){this.delta=new Map,this.DELETED=Symbol("deleted")}getDeletedSymbol(){return this.DELETED}isDirty(){return this.delta.size>0}size(){return this.delta.size}has(e){return this.delta.has(e)}get(e){return this.delta.get(e)}set(e,n){this.delta.set(e,n)}delete(e){this.delta.set(e,this.DELETED)}isDeleted(e){return this.delta.get(e)===this.DELETED}clear(){this.delta.clear()}entries(){return Array.from(this.delta.entries()).sort((e,n)=>{const s=e[0].split(".").length,r=n[0].split(".").length;return s-r})}createCheckpoint(){return new Map(this.delta)}restoreCheckpoint(e){this.delta.clear();for(const[n,s]of e)this.delta.set(n,s)}}function ie(t){return t!==null&&typeof t=="object"}function z(t,e,n=new WeakMap){if(!ie(t))return t;if(n.has(t))return n.get(t);const s=e.has(t)?e.get(t):t;if(s!==t&&n.has(s)){const i=n.get(s);return n.set(t,i),i}if(s instanceof Map){const i=new Map;n.set(t,i),s!==t&&n.set(s,i);let a=!1;for(const[f,u]of s.entries()){const d=z(f,e,n),h=z(u,e,n);i.set(d,h),(d!==f||h!==u)&&(a=!0)}const l=a?i:s;return n.set(t,l),s!==t&&n.set(s,l),l}if(s instanceof Set){const i=new Set;n.set(t,i),s!==t&&n.set(s,i);let a=!1;for(const f of s.values()){const u=z(f,e,n);i.add(u),u!==f&&(a=!0)}const l=a?i:s;return n.set(t,l),s!==t&&n.set(s,l),l}if(Array.isArray(s)){const i=[];n.set(t,i),s!==t&&n.set(s,i);let a=!1;for(const f of s){const u=z(f,e,n);i.push(u),u!==f&&(a=!0)}const l=a?i:s;return n.set(t,l),s!==t&&n.set(s,l),l}const r={};n.set(t,r),s!==t&&n.set(s,r);let o=!1;for(const[i,a]of Object.entries(s)){const l=z(a,e,n);r[i]=l,l!==a&&(o=!0)}const c=o?r:s;return n.set(t,c),s!==t&&n.set(s,c),c}function L(t){return t!==null&&typeof t=="object"}function I(t,e,n,s,r){if(s.has(t))return s.get(t);const o=e.getDeletedSymbol(),c=new Proxy(t,{get(i,a){if(typeof a=="symbol")return i[a];const l=[...n,String(a)],f=l.join(".");if(e.has(f)){const d=e.get(f);return d===o?void 0:L(d)?r.has(d)?d:I(d,e,l,s,r):d}const u=i[a];if(typeof u=="function"&&Array.isArray(i)){const d=String(a);return["push","pop","shift","unshift","splice","sort","reverse"].includes(d)?function(...g){const y=n.join(".");let E;e.has(y)?E=e.get(y):(E=[...i],e.set(y,E));let S=g;return(d==="push"||d==="unshift"||d==="splice")&&(S=g.map((p,m)=>{if(!L(p))return p;if(s.has(p))return s.get(p);if(r.has(p))return p;let P;if(d==="push")P=[...n,String(E.length+m)];else if(d==="unshift")P=[...n,String(m)];else{const O=g[0];if(m<2)return p;P=[...n,String(O+m-2)]}return I(p,e,P,s,r)})),u.apply(E,S)}:["find","findLast","filter","map","flatMap"].includes(d)?function(...g){const y=u.apply(i,g);if(y==null)return y;if(d==="find"||d==="findLast"){if(L(y)){const E=i.indexOf(y);if(E!==-1){const S=[...n,String(E)];return I(y,e,S,s,r)}}return y}else return Array.isArray(y)?y.map((E,S)=>{if(L(E)){const w=i.indexOf(E);if(w!==-1){const p=[...n,String(w)];return I(E,e,p,s,r)}}return E}):y}:u.bind(i)}if(typeof u=="function"&&i instanceof Map){const d=String(a);return["set","delete","clear"].includes(d)?function(...y){if(d==="set"&&y.length>=2){const[E,S]=y,w=[...n,String(E)],p=w.join(".");let m=S;return L(S)&&(s.has(S)?m=s.get(S):r.has(S)||(m=I(S,e,w,s,r))),e.set(p,m),i}if(d==="delete"&&y.length>=1){const[E]=y,w=[...n,String(E)].join(".");return e.delete(w),!0}if(d==="clear"){const E=new Set(i.keys()),S=n.join(".")+".";for(const[w]of e.entries())if(w.startsWith(S)){const p=w.slice(S.length);p.includes(".")||E.add(p)}for(const w of E){const m=[...n,String(w)].join(".");e.delete(m)}return}return u.apply(i,y)}:["get"].includes(d)?function(...y){const[E]=y,S=[...n,String(E)],w=S.join(".");if(e.has(w)){const m=e.get(w);return m===o?void 0:L(m)?s.has(m)?s.get(m):r.has(m)?m:I(m,e,S,s,r):m}const p=i.get(E);return p!=null&&L(p)?s.has(p)?s.get(p):r.has(p)?p:I(p,e,S,s,r):p}:["values","entries","keys","forEach"].includes(d)?function(...y){const E=new Map;for(const[w,p]of i.entries())E.set(w,p);const S=n.join(".")+".";for(const[w,p]of e.entries())if(w.startsWith(S)){const m=w.slice(S.length);if(!m.includes(".")){const P=m;p===o?E.delete(P):E.set(P,p)}}if(d==="forEach"){const[w,p]=y;for(const[m,P]of E.entries()){let O=P;if(L(P)){const F=[...n,String(m)];s.has(P)?O=s.get(P):r.has(P)||(O=I(P,e,F,s,r))}w.call(p,O,m,i)}return}else{let w;return d==="values"?w=E.values():d==="entries"?w=E.entries():w=E.keys(),{[Symbol.iterator](){return this},next(){const p=w.next();if(!p.done&&p.value!==void 0){if(d==="values"){const m=p.value;if(L(m)){let P=null;for(const[O,F]of E.entries())if(F===m){P=O;break}if(P!==null&&!s.has(m)&&!r.has(m)){const O=[...n,String(P)];p.value=I(m,e,O,s,r)}else s.has(m)&&(p.value=s.get(m))}}else if(d==="entries"){const[m,P]=p.value;if(L(P)){if(s.has(P))p.value=[m,s.get(P)];else if(!r.has(P)){const O=[...n,String(m)];p.value=[m,I(P,e,O,s,r)]}}}}return p}}}}:u.bind(i)}if(typeof u=="function"&&i instanceof Set){const d=String(a);return["add","delete","clear"].includes(d)?function(...A){const g=n.join(".");let y;if(e.has(g)?y=e.get(g):(y=new Set(i),e.set(g,y)),d==="add"&&A.length>=1){const S=A[0];if(L(S)&&!s.has(S)&&!r.has(S)){const w=[...n,String(S)];A[0]=I(S,e,w,s,r)}}return u.apply(y,A)}:u.bind(i)}return L(u)?r.has(u)?u:I(u,e,l,s,r):u},set(i,a,l){const u=[...n,String(a)].join(".");return e.set(u,l),!0},has(i,a){const f=[...n,String(a)].join(".");return e.has(f)?e.get(f)!==o:a in i},deleteProperty(i,a){const f=[...n,String(a)].join(".");return e.delete(f),!0},ownKeys(i){const a=Reflect.ownKeys(i),l=n.length>0?n.join(".")+".":"",f=new Set;for(const[d,h]of e.entries())if(d.startsWith(l)){const A=d.slice(l.length),g=A.indexOf("."),y=g===-1?A:A.slice(0,g);h!==o&&f.add(y)}const u=new Set(a);for(const[d,h]of e.entries())if(d.startsWith(l)){const A=d.slice(l.length);if(A.indexOf(".")===-1){const y=A;h===o?u.delete(y):u.add(y)}}return Array.from(u)},getOwnPropertyDescriptor(i,a){const f=[...n,String(a)].join(".");if(e.has(f)){const u=e.get(f);return u===o?void 0:{value:u,writable:!0,enumerable:!0,configurable:!0}}return Reflect.getOwnPropertyDescriptor(i,a)}});return s.set(t,c),r.set(c,t),c}const _={SET:"SET",DELETE:"DELETE",ARRAY_PUSH:"ARRAY_PUSH",ARRAY_POP:"ARRAY_POP",ARRAY_SHIFT:"ARRAY_SHIFT",ARRAY_UNSHIFT:"ARRAY_UNSHIFT",ARRAY_SPLICE:"ARRAY_SPLICE",ARRAY_SORT:"ARRAY_SORT",ARRAY_REVERSE:"ARRAY_REVERSE",ARRAY_FILL:"ARRAY_FILL",ARRAY_COPYWITHIN:"ARRAY_COPYWITHIN",MAP_SET:"MAP_SET",MAP_DELETE:"MAP_DELETE",MAP_CLEAR:"MAP_CLEAR",SET_ADD:"SET_ADD",SET_DELETE:"SET_DELETE",SET_CLEAR:"SET_CLEAR",SCRIPT:"SCRIPT"},b={TYPE:"__type__",CLASS:"__class__",DATE_VALUE:"__dateValue__"};var T=(t=>(t[t.NULL=0]="NULL",t[t.UNDEFINED=1]="UNDEFINED",t[t.PRIMITIVE=2]="PRIMITIVE",t[t.BIGINT=3]="BIGINT",t[t.SYMBOL=4]="SYMBOL",t[t.DATE=5]="DATE",t[t.REGEXP=6]="REGEXP",t[t.FUNCTION=7]="FUNCTION",t[t.ARRAY=8]="ARRAY",t[t.MAP=9]="MAP",t[t.SET=10]="SET",t[t.OBJECT=11]="OBJECT",t))(T||{});function oe(t){if(t===null)return{category:0,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};if(t===void 0)return{category:1,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};const e=typeof t;return e==="string"||e==="number"||e==="boolean"?{category:2,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1}:e==="bigint"?{category:3,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:e==="symbol"?{category:4,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:t instanceof Date?{category:5,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:t instanceof RegExp?{category:6,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:e==="function"?{category:7,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:Array.isArray(t)?{category:8,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!1}:t instanceof Map?{category:9,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:t instanceof Set?{category:10,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:{category:11,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!1}}function ce(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return!(e===null||e===Object.prototype||t instanceof Date||t instanceof RegExp||t instanceof Map||t instanceof Set||t instanceof Array||t instanceof Error||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)}function ae(t){const e=Object.getPrototypeOf(t);if(!e||e===Object.prototype)return null;const n=e.constructor;return!n||!n.name?null:n.name}class le{constructor(e,n){this.targetToPath=e,this.currentPath=n,this.seen=new Map}hasSeen(e){return this.seen.has(e)}markSeen(e,n){this.seen.set(e,n)}getReference(e){const n=this.targetToPath.get(e);return n&&n.length>0&&!(n.length>=this.currentPath.length&&this.currentPath.every((r,o)=>r===n[o]))?{__type__:"ref",path:n}:this.hasSeen(e)?{__type__:"ref",path:this.seen.get(e).slice(this.currentPath.length)}:null}}function x(t,e,n,s){const r=typeof t=="object"&&t!==null&&s.get(t)||t,o=oe(r);switch(o.category){case T.NULL:case T.UNDEFINED:return t;case T.PRIMITIVE:return t;case T.BIGINT:return{[b.TYPE]:"bigint",value:t.toString()};case T.SYMBOL:return{[b.TYPE]:"symbol",description:t.description};case T.DATE:{const c=s.get(t)||t,i=n.getReference(c);if(i)return i;n.markSeen(c,e);const a=c,l=a.getTime(),f=isNaN(l)?null:a.toISOString(),u={[b.TYPE]:"date",[b.DATE_VALUE]:f},d=Object.entries(a);for(const[h,A]of d)u[h]=x(A,[...e,h],n,s);return u}case T.REGEXP:{const c=s.get(t)||t,i=n.getReference(c);if(i)return i;n.markSeen(c,e);const a=c;return{[b.TYPE]:"regexp",source:a.source,flags:a.flags,lastIndex:a.lastIndex}}case T.FUNCTION:{const c=t;return c.__type__==="function"?{[b.TYPE]:"function",sourceCode:c.sourceCode||t.toString()}:void 0}case T.MAP:case T.SET:case T.ARRAY:case T.OBJECT:{const c=s.get(t)||t,i=n.getReference(c);if(i)return i;if(n.markSeen(c,e),o.category===T.MAP)return{[b.TYPE]:"map",entries:Array.from(c.entries()).map(([f,u],d)=>[x(f,[...e,"key",String(d)],n,s),x(u,[...e,"value",String(d)],n,s)])};if(o.category===T.SET)return{[b.TYPE]:"set",values:Array.from(c.values()).map((f,u)=>x(f,[...e,String(u)],n,s))};if(o.category===T.ARRAY)return t.map((f,u)=>x(f,[...e,String(u)],n,s));const a={},l=t;if(ce(c)){const f=ae(c);f&&(a[b.CLASS]=f)}for(const f in l)Object.prototype.hasOwnProperty.call(l,f)&&(a[f]=x(l[f],[...e,f],n,s));return a}default:return}}const k=(t,e,n,s)=>{const r=new le(n,s);return x(t,s,r,e)},fe=t=>typeof t=="object"&&t!==null&&"__type__"in t&&typeof t.__type__=="string",J=t=>{const n=new Function(`return (${t.sourceCode})`)();return n.__type__="function",n.sourceCode=t.sourceCode,n},X=(t,e,n)=>{if(!("__dateValue__"in t))throw new Error("Invalid Date serialization format: missing __dateValue__ field");const s=t.__dateValue__,r=s===null?new Date("invalid"):new Date(s);for(const[o,c]of Object.entries(t))o==="__type__"||o==="__dateValue__"||(r[o]=e(c,n));return r},C=t=>{const e=new RegExp(t.source,t.flags);return t.lastIndex!==void 0&&(e.lastIndex=t.lastIndex),e},Q=t=>BigInt(t.value),Z=t=>Symbol(t.description),N=t=>typeof t=="object"&&t!==null&&"__unresolved_ref__"in t,ue=(t,e)=>{const n=new Map;for(const[s,r]of t.entries){const o=typeof s=="object"&&s!==null&&s.__type__&&Y[s.__type__]?.(s,e)||s,c=typeof r=="object"&&r!==null&&r.__type__&&Y[r.__type__]?.(r,e)||r;n.set(o,c)}return n},de=(t,e)=>{const n=new Set;for(const s of t.values){const r=typeof s=="object"&&s!==null&&s.__type__&&Y[s.__type__]?.(s,e)||s;n.add(r)}return n},Y={function:t=>J(t),date:(t,e)=>X(t,(s,r)=>{if(s&&typeof s=="object"&&"__type__"in s){const o=Y[s.__type__];return o?o(s,e):s}return s},e),regexp:t=>C(t),bigint:t=>Q(t),symbol:t=>Z(t),ref:t=>({__unresolved_ref__:t.path}),map:(t,e)=>ue(t,e),set:(t,e)=>de(t,e)};function pe(t,e,n){const s=[];function r(c,i=[]){if(c===null||typeof c!="object")return c;if(c.__type__&&Y[c.__type__]){const a=Y[c.__type__];if(!a)return c;const l=a(c,t);if(l&&N(l))return s.push({parent:null,key:null,path:l.__unresolved_ref__}),l;if(l instanceof Date){for(const f in l)if(Object.prototype.hasOwnProperty.call(l,f)){const u=l[f];u&&N(u)&&s.push({parent:l,key:f,path:u.__unresolved_ref__})}}return l}for(const a in c)if(Object.prototype.hasOwnProperty.call(c,a)){const l=c[a];if(l&&typeof l=="object")if(l.__type__&&Y[l.__type__]){const f=Y[l.__type__];if(!f)continue;const u=f(l,t);if(u&&N(u))s.push({parent:c,key:a,path:u.__unresolved_ref__});else if(c[a]=u,u instanceof Date){for(const d in u)if(Object.prototype.hasOwnProperty.call(u,d)){const h=u[d];h&&N(h)&&s.push({parent:u,key:d,path:h.__unresolved_ref__})}}}else{const f=r(l,[...i,a]);f!==l&&(c[a]=f)}}return c}let o=r(t);for(const c of s){const{parent:i,key:a,path:l}=c,f=e(l,o);i&&a!==null?i[a]=f:i===null&&a===null&&(o=f)}return o}function ye(t,e,n){return pe(t,(o,c)=>{let i=c,a=!0;for(const l of o){const f=i?.[l];if(f===void 0){a=!1;break}i=f}if(a)return i;i=e;for(const l of o){const f=i?.[l];if(f===void 0)throw new Error(`Cannot resolve event value ref path: ${o.join(".")} (not found in value scope or memory scope)`);i=f}return i})}const D=(t,e,n=new WeakMap,s)=>{if(t==null||typeof t!="object")return t;if(n.has(t))return n.get(t);if(fe(t)){const o=t;switch(o.__type__){case"function":return J(o);case"date":return X(o,(a,l)=>D(a,e,n),e);case"regexp":return C(o);case"bigint":return Q(o);case"symbol":return Z(o);case"ref":{const c=o;let i=e;for(const a of c.path)if(i=i[a],i===void 0)throw new Error(`Cannot resolve ref path: ${c.path.join(".")}`);return i}case"map":{const c=o,i=new Map;n.set(t,i);for(const[a,l]of c.entries){const f=D(a,e,n),u=D(l,e,n);i.set(f,u)}return i}case"set":{const c=o,i=new Set;n.set(t,i);for(const a of c.values)i.add(D(a,e,n));return i}case"circular":throw new Error("Encountered explicit circular marker - this indicates a serialization issue")}}if(Array.isArray(t)){const o=[];n.set(t,o);for(const c of t)o.push(D(c,e,n));return o}const r={};n.set(t,r);for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=D(t[o],e,n));return r};class Ee{createEvent(e,n,s){const[r]=n;return{type:_.SET,path:e,value:k(r,s.proxyToTarget,s.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,s,r){const c=ye(e.value,r);n instanceof Map?n.set(s,c):n[s]=c}}class me{createEvent(e){return{type:_.DELETE,path:e,timestamp:Date.now()}}applyEvent(e,n,s){delete n[s]}}class _e{createEvent(e,n,s){return{type:_.ARRAY_PUSH,path:e,items:n.map(r=>k(r,s.proxyToTarget,s.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s];for(const i of o.items)c.push(D(i,r))}}class he{createEvent(e){return{type:_.ARRAY_POP,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].pop()}}class Se{createEvent(e){return{type:_.ARRAY_SHIFT,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].shift()}}class we{createEvent(e,n,s){return{type:_.ARRAY_UNSHIFT,path:e,items:n.map(r=>k(r,s.proxyToTarget,s.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=o.items.map(a=>D(a,r));c.unshift(...i)}}class Ae{createEvent(e,n,s){return{type:_.ARRAY_SPLICE,path:e,start:n[0],deleteCount:n[1]||0,items:n.slice(2).map(r=>k(r,s.proxyToTarget,s.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=o.items.map(a=>D(a,r));c.splice(o.start,o.deleteCount,...i)}}class ge{createEvent(e){return{type:_.ARRAY_SORT,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].sort()}}class Pe{createEvent(e){return{type:_.ARRAY_REVERSE,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].reverse()}}class Re{createEvent(e,n,s){return{type:_.ARRAY_FILL,path:e,value:k(n[0],s.proxyToTarget,s.targetToPath,e),start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=D(o.value,r);c.fill(i,o.start,o.end)}}class ve{createEvent(e,n){return{type:_.ARRAY_COPYWITHIN,path:e,target:n[0],start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,s){const r=e;n[s].copyWithin(r.target,r.start,r.end)}}class Te{createEvent(e,n,s){return{type:_.MAP_SET,path:e,key:k(n[0],s.proxyToTarget,s.targetToPath,e),value:k(n[1],s.proxyToTarget,s.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=D(o.key,r),a=D(o.value,r);c.set(i,a)}}class De{createEvent(e,n,s){return{type:_.MAP_DELETE,path:e,key:k(n[0],s.proxyToTarget,s.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=D(o.key,r);c.delete(i)}}class Ie{createEvent(e){return{type:_.MAP_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].clear()}}class Le{createEvent(e,n,s){return{type:_.SET_ADD,path:e,value:k(n[0],s.proxyToTarget,s.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=D(o.value,r);c.add(i)}}class Oe{createEvent(e,n,s){return{type:_.SET_DELETE,path:e,value:k(n[0],s.proxyToTarget,s.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,s,r){const o=e,c=n[s],i=D(o.value,r);c.delete(i)}}class ke{createEvent(e){return{type:_.SET_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,s){n[s].clear()}}class be{createEvent(e,n){return{type:_.SCRIPT,path:e,source:n[0],timestamp:Date.now()}}applyEvent(){}}class Ye{constructor(){this.handlers=new Map}register(e,n){this.handlers.set(e,n)}createEvent(e,n,s,r){const o=this.handlers.get(e);if(!o)throw new Error(`No handler registered for event type: ${e}`);return o.createEvent(n,s,r)}applyEvent(e,n,s,r){const o=this.handlers.get(e.type);if(!o)throw new Error(`No handler registered for event type: ${e.type}`);o.applyEvent(e,n,s,r)}hasHandler(e){return this.handlers.has(e)}}const R=new Ye;R.register(_.SET,new Ee);R.register(_.DELETE,new me);R.register(_.ARRAY_PUSH,new _e);R.register(_.ARRAY_POP,new he);R.register(_.ARRAY_SHIFT,new Se);R.register(_.ARRAY_UNSHIFT,new we);R.register(_.ARRAY_SPLICE,new Ae);R.register(_.ARRAY_SORT,new ge);R.register(_.ARRAY_REVERSE,new Pe);R.register(_.ARRAY_FILL,new Re);R.register(_.ARRAY_COPYWITHIN,new ve);R.register(_.MAP_SET,new Te);R.register(_.MAP_DELETE,new De);R.register(_.MAP_CLEAR,new Ie);R.register(_.SET_ADD,new Le);R.register(_.SET_DELETE,new Oe);R.register(_.SET_CLEAR,new ke);R.register(_.SCRIPT,new be);function ee(t,e,n={}){const{createIntermediates:s=!1}=n;if(e.length===0)return null;if(e.length===1)return{parent:t,key:e[0],exists:!0};let r=t,o=!0;for(let i=0;i<e.length-1;i++){const a=e[i];if(a)if(r instanceof Map){if(!r.has(a))if(s){const l=e[i+1],f=l&&/^\d+$/.test(l)?[]:{};r.set(a,f)}else{o=!1;break}r=r.get(a)}else if(r!==null&&typeof r=="object"){if(!(a in r))if(s){const l=e[i+1];r[a]=l&&/^\d+$/.test(l)?[]:{}}else{o=!1;break}r=r[a]}else{o=!1;break}}const c=e[e.length-1];return{parent:r,key:c,exists:o}}const U=(t,e)=>{const n=ee(t,e.path,{createIntermediates:!0});if(!n)return;const{parent:s,key:r}=n;R.applyEvent(e,s,r,t)},j=async(t,e,n)=>{if(n.isReplaying=!0,Array.isArray(e))for(const s of e)U(t,s);else for await(const s of e)U(t,s);n.isReplaying=!1},xe=async(t,e,n)=>{if(e.stream)await j(t,e.stream(),n);else{const s=await e.getAll();await j(t,s,n)}};async function te(t){const e=new re,n=e.getDeletedSymbol(),s=new WeakMap,r=new WeakMap,o={};return await xe(o,t,{isReplaying:!0}),{root:I(o,e,[],s,r),isDirty(){return e.isDirty()},getUncommittedCount(){return e.size()},async save(){const i=e.entries(),a=new WeakMap,l=(f,u,d=[])=>{if(!(u===null||typeof u!="object")&&!f.has(u))if(f.set(u,d),Array.isArray(u))u.forEach((h,A)=>l(f,h,[...d,String(A)]));else if(u instanceof Map){let h=0;u.forEach(A=>l(f,A,[...d,`map:${h++}`]))}else if(u instanceof Set){let h=0;u.forEach(A=>l(f,A,[...d,`set:${h++}`]))}else u instanceof Date||Object.entries(u).forEach(([h,A])=>l(f,A,[...d,h]))};for(const[f,u]of i){const d=new WeakMap;l(d,o);const h=f.split("."),A=ee(o,h,{createIntermediates:!1});if(!A)continue;const{parent:g,key:y}=A;if(u===n)g instanceof Map||g instanceof Set?g.delete(y):g!==null&&typeof g=="object"&&delete g[y],await t.append({type:"DELETE",path:h,timestamp:Date.now()});else{const E=z(u,r,a),S=k(E,new WeakMap,d,h);g instanceof Map?g.set(y,E):g!==null&&typeof g=="object"&&(g[y]=E),await t.append({type:"SET",path:h,value:S,timestamp:Date.now()})}}e.clear()},discard(){e.clear()},createCheckpoint(){return e.createCheckpoint()},restoreCheckpoint(i){e.restoreCheckpoint(i)},unwrap(i){return z(i,r)}}}let H,B,v;async function W(){try{H=se("ireneo-demo","todos"),B=await te(H),v=B.root,v.todos||(v.todos=[],v.nextId=1);const t=localStorage.getItem("ireneo-demo-theme")||"light";document.documentElement.setAttribute("data-theme",t),ne(t),$e(),await M(),console.log("Ireneo demo initialized"),console.log(`Loaded ${v.todos.length} todos from IndexedDB`)}catch(t){console.error("Initialization error:",t),alert("Failed to initialize app. Check console for details.")}}async function q(t){if(!t.trim())return;v.todos.push({id:v.nextId++,text:t.trim(),done:!1,createdAt:new Date}),await V();const e=document.getElementById("new-todo");e&&(e.value=""),await M()}async function ze(t){const e=v.todos.find(n=>n.id===t);e&&(e.done=!e.done,await V(),await M())}async function He(t){const e=v.todos.findIndex(n=>n.id===t);e>=0&&(v.todos.splice(e,1),await V(),await M())}async function V(){try{await B.save(),K("Saved to IndexedDB","success")}catch(t){console.error("Save error:",t),K("Save failed","error")}}async function Be(){if(confirm("Clear all todos and events? This cannot be undone."))try{v.todos.length=0,v.nextId=1,await B.save(),H.clear&&await H.clear(),B=await te(H),v=B.root,v.todos=[],v.nextId=1,await M(),K("All data cleared","success")}catch(t){console.error("Clear error:",t),K("Clear failed","error")}}async function M(){Me(),await Ne()}function Me(){const t=document.getElementById("todo-list");if(t){if(v.todos.length===0){t.innerHTML='<li class="empty-state" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">No todos yet. Add one above!</li>';return}t.innerHTML=v.todos.map(e=>`
    <li class="todo-item ${e.done?"done":""}">
      <input
        type="checkbox"
        ${e.done?"checked":""}
        onchange="window.toggleTodoAsync(${e.id})"
      />
      <span class="todo-text">${$(e.text)}</span>
      <button class="todo-delete" onclick="window.deleteTodoAsync(${e.id})" title="Delete">×</button>
    </li>
  `).join("")}}async function Ne(){const t=document.getElementById("event-list"),e=document.getElementById("event-count"),n=document.getElementById("storage-size");if(!(!t||!e||!n))try{const s=await H.getAll();if(s.length===0){t.innerHTML='<div class="empty-state" style="text-align: center; color: var(--text-tertiary); padding: 2rem;">No events yet. Interact with todos to see mutations!</div>',e.textContent="0 events",n.textContent="0 KB";return}const r=s.slice(-50).reverse();t.innerHTML=r.map(i=>{const a=JSON.stringify(i.path);let l="";return i.type==="SET"&&"value"in i?l=`<div class="event-value">value: ${G(i.value)}</div>`:i.type==="ARRAY_PUSH"&&"items"in i?l=`<div class="event-value">pushed: ${G(i.items[0])}</div>`:i.type==="ARRAY_SPLICE"&&"start"in i&&(l=`<div class="event-value">index: ${i.start}, deleted: ${i.deleteCount}</div>`),`
        <div class="event event-${i.type}">
          <span class="event-type">${i.type}</span>
          <div class="event-path">${$(a)}</div>
          ${l}
        </div>
      `}).join(""),e.textContent=`${s.length} event${s.length!==1?"s":""}`;const c=(JSON.stringify(s).length/1024).toFixed(1);n.textContent=`${c} KB`}catch(s){console.error("Error rendering events:",s),t.innerHTML='<div style="color: var(--danger); padding: 1rem;">Error loading events</div>'}}function $e(){const t=document.getElementById("add-btn"),e=document.getElementById("new-todo");t&&e&&(t.addEventListener("click",()=>{q(e.value).catch(console.error)}),e.addEventListener("keypress",r=>{r.key==="Enter"&&q(e.value).catch(console.error)}));const n=document.getElementById("clear-all-btn");n&&n.addEventListener("click",Be);const s=document.getElementById("theme-toggle");s&&s.addEventListener("click",Ke),window.toggleTodoAsync=r=>ze(r).catch(console.error),window.deleteTodoAsync=r=>He(r).catch(console.error)}function Ke(){const e=(document.documentElement.getAttribute("data-theme")||"light")==="light"?"dark":"light";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("ireneo-demo-theme",e),ne(e)}function ne(t){const e=document.getElementById("theme-toggle");e&&(e.textContent=t==="light"?"🌙":"☀️")}function $(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function G(t){return typeof t=="string"?`"${$(t)}"`:$(JSON.stringify(t,null,2))}function K(t,e){console.log(`[${e.toUpperCase()}] ${t}`)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",W):W();</script>
  <style rel="stylesheet" crossorigin>:root{--primary: #4F46E5;--primary-hover: #4338CA;--success: #10B981;--warning: #F59E0B;--danger: #EF4444;--bg-primary: #FFFFFF;--bg-secondary: #F9FAFB;--bg-tertiary: #F3F4F6;--text-primary: #111827;--text-secondary: #6B7280;--text-tertiary: #9CA3AF;--border: #E5E7EB;--border-focus: #4F46E5;--event-push-bg: #D1FAE5;--event-push-border: #10B981;--event-set-bg: #FED7AA;--event-set-border: #F59E0B;--event-delete-bg: #FECACA;--event-delete-border: #EF4444;--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .05);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .1)}[data-theme=dark]{--bg-primary: #1F2937;--bg-secondary: #111827;--bg-tertiary: #374151;--text-primary: #F9FAFB;--text-secondary: #D1D5DB;--text-tertiary: #9CA3AF;--border: #374151;--border-focus: #6366F1;--event-push-bg: #065F46;--event-push-border: #10B981;--event-set-bg: #78350F;--event-set-border: #F59E0B;--event-delete-bg: #7F1D1D;--event-delete-border: #EF4444;--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .3);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .4);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .5)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;color:var(--text-primary);background:var(--bg-secondary);transition:background-color .2s ease,color .2s ease}.container{max-width:1400px;margin:0 auto;padding:2rem 1.5rem}.header{text-align:center;margin-bottom:2rem}.header h1{font-size:2.5rem;font-weight:700;color:var(--text-primary);margin-bottom:.5rem}.header .subtitle{font-size:1rem;color:var(--text-secondary)}.app{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-bottom:2rem}.panel{background:var(--bg-primary);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow-md);overflow:hidden;display:flex;flex-direction:column;height:calc(100vh - 300px);min-height:500px;max-height:700px}.panel-header{padding:1.5rem;border-bottom:1px solid var(--border);background:var(--bg-secondary)}.panel-header h2{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin:0}.panel-header .subtitle{font-size:.875rem;color:var(--text-secondary);margin-top:.25rem}.panel-body{flex:1;display:flex;flex-direction:column;overflow:hidden;padding:1.5rem}.scrollable-content{flex:1;overflow-y:auto;display:flex;flex-direction:column}.panel-footer{padding:1.5rem;border-top:1px solid var(--border);background:var(--bg-secondary)}.input-group{display:flex;gap:.5rem;margin-bottom:1.5rem}#new-todo{flex:1;padding:.75rem 1rem;font-size:1rem;border:1px solid var(--border);border-radius:8px;background:var(--bg-primary);color:var(--text-primary);transition:border-color .15s ease,box-shadow .15s ease}#new-todo:focus{outline:none;border-color:var(--border-focus);box-shadow:0 0 0 3px #4f46e51a}#new-todo::placeholder{color:var(--text-tertiary)}.btn{padding:.75rem 1.25rem;font-size:.875rem;font-weight:500;border:none;border-radius:8px;cursor:pointer;transition:all .15s ease;white-space:nowrap}.btn-primary{background:var(--primary);color:#fff}.btn-primary:hover{background:var(--primary-hover);transform:translateY(-1px);box-shadow:var(--shadow-md)}.btn-secondary{background:var(--bg-tertiary);color:var(--text-primary);border:1px solid var(--border)}.btn-secondary:hover{background:var(--bg-secondary);transform:translateY(-1px)}.btn-success{background:var(--success);color:#fff}.btn-success:hover{background:#059669;transform:translateY(-1px)}.btn-danger{background:var(--danger);color:#fff}.btn-danger:hover{background:#dc2626;transform:translateY(-1px)}.btn:disabled{opacity:.5;cursor:not-allowed;transform:none!important}.icon-btn{background:none;border:none;font-size:1.25rem;cursor:pointer;padding:.25rem .5rem;transition:transform .15s ease}.icon-btn:hover{transform:scale(1.1)}.todo-list{list-style:none}.todo-item{display:flex;align-items:center;gap:.75rem;padding:.875rem;border-radius:8px;background:var(--bg-secondary);border:1px solid var(--border);margin-bottom:.5rem;transition:all .15s ease}.todo-item:hover{border-color:var(--primary);box-shadow:var(--shadow-sm)}.todo-item.done .todo-text{text-decoration:line-through;color:var(--text-tertiary)}.todo-item input[type=checkbox]{width:1.25rem;height:1.25rem;cursor:pointer;accent-color:var(--primary)}.todo-text{flex:1;color:var(--text-primary);font-size:.9375rem}.todo-delete{background:var(--danger);color:#fff;border:none;border-radius:4px;width:1.75rem;height:1.75rem;font-size:1.125rem;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s ease}.todo-delete:hover{background:#dc2626;transform:scale(1.1)}.actions{display:flex;gap:.5rem;flex-wrap:wrap}.auto-save-notice{margin-top:.75rem;text-align:center}.event-list{display:flex;flex-direction:column;gap:.5rem}.event{padding:.75rem 1rem;border-radius:6px;border-left:3px solid;font-size:.875rem;animation:slideIn .3s ease}@keyframes slideIn{0%{opacity:0;transform:translate(-10px)}to{opacity:1;transform:translate(0)}}.event-ARRAY_PUSH{background:var(--event-push-bg);border-color:var(--event-push-border)}.event-SET{background:var(--event-set-bg);border-color:var(--event-set-border)}.event-ARRAY_SPLICE,.event-DELETE{background:var(--event-delete-bg);border-color:var(--event-delete-border)}.event-type{font-weight:600;font-family:Monaco,Courier New,monospace;font-size:.8125rem;display:inline-block;margin-right:.5rem}.event-path{font-family:Monaco,Courier New,monospace;font-size:.75rem;color:var(--text-secondary);display:block;margin-top:.25rem;word-break:break-all}.event-value{font-family:Monaco,Courier New,monospace;font-size:.75rem;color:var(--text-primary);display:block;margin-top:.25rem;word-break:break-all}.stats{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;background:var(--bg-secondary);border-radius:8px;font-size:.875rem;color:var(--text-secondary);border:1px solid var(--border)}.stat{font-weight:500}.separator{color:var(--text-tertiary)}.footer{text-align:center;padding:2rem 0;font-size:.875rem;color:var(--text-secondary)}.footer a{color:var(--primary);text-decoration:none;transition:color .15s ease}.footer a:hover{color:var(--primary-hover);text-decoration:underline}@media(max-width:768px){.app{grid-template-columns:1fr}.header h1{font-size:2rem}.container{padding:1rem}}.scrollable-content::-webkit-scrollbar{width:8px}.scrollable-content::-webkit-scrollbar-track{background:var(--bg-secondary);border-radius:4px}.scrollable-content::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}.scrollable-content::-webkit-scrollbar-thumb:hover{background:var(--text-tertiary)}</style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Ireneo Demo</h1>
            <p class="subtitle">TodoMVC with Mutation Sourcing</p>
        </header>

        <div class="app">
            <!-- Left Panel: Todo List -->
            <div class="panel todos-panel">
                <div class="panel-header">
                    <h2>📝 Todos</h2>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <input
                            id="new-todo"
                            type="text"
                            placeholder="What needs to be done?"
                            autocomplete="off"
                        />
                        <button id="add-btn" class="btn btn-primary">Add</button>
                    </div>
                    <div class="scrollable-content">
                        <ul id="todo-list" class="todo-list"></ul>
                    </div>
                </div>
                <div class="panel-footer">
                    <button id="clear-all-btn" class="btn btn-danger">Clear All</button>
                    <div class="auto-save-notice">
                        <small style="color: var(--text-tertiary);">✨ Auto-saves on every change</small>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Event Log -->
            <div class="panel events-panel">
                <div class="panel-header">
                    <h2>📊 Event Log</h2>
                    <span class="subtitle">Live Mutation Tracking</span>
                </div>
                <div class="panel-body">
                    <div class="scrollable-content">
                        <div id="event-list" class="event-list"></div>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="stats">
                        <span id="event-count" class="stat">0 events</span>
                        <span class="separator">•</span>
                        <span id="storage-size" class="stat">0 KB</span>
                        <button id="theme-toggle" class="icon-btn" title="Toggle theme">🌙</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>
                Powered by <a href="https://github.com/xrrocha/ireneo" target="_blank">Ireneo</a>
                • No server, no database, just JavaScript
                • <a href="https://github.com/xrrocha/ireneo/blob/main/docs/primer.md" target="_blank">Read the Primer</a>
            </p>
        </footer>
    </div>

    <!-- Load main module -->
</body>
</html>
